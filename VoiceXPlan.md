### **FunASR 听写应用开发与测试计划 (个人使用版)**

**项目目标**: 开发一个基于 FunASR、Docker 和 `launchd` 的、具备 7x24 小时不间断运行能力的 macOS 实时听写应用，供个人稳定使用。

**核心策略**: 采用“Worker-Supervisor-Client”三层架构，分阶段开发，每个阶段都有明确的测试目标，确保在进入下一阶段前，当前阶段的功能是稳定可靠的。

---

#### **第一阶段：构建 Worker 核心引擎 (预计时间：3天)**

* **目标**: 创建一个包含 FunASR 模型的、可通过 TCP 端口进行流式识别的、独立的 Docker 容器。
* **任务**:
    1.  **编写 FunASR TCP 服务脚本**: 实现一个基础的 TCP 服务器，集成 FunASR 流式模型，并定义好“头部(长度) + 数据体(音频)”的数据帧协议。
    2.  **创建 Dockerfile 并构建镜像**: 编写 `Dockerfile`，包含安装所有依赖、复制脚本、以及在构建时预下载模型等步骤。
* **第一阶段测试节点 (预计完成时间：2025年8月6日，周三)**
    * **测试方法**: 在终端手动运行 Docker 容器，并使用一个简单的 Python 测试脚本作为客户端连接服务，发送音频数据，验证能否正确接收到识别结果。
    * **验收标准**: **容器能稳定运行，并且 TCP 服务能正确处理流式音频并返回结果。**

---

#### **第二阶段：部署 Supervisor 守护服务 (预计时间：2天)**

* **目标**: 使用 macOS 的 `launchd` 实现对 Docker 容器的自动化管理，确保其“永不宕机”。
* **任务**:
    1.  **编写 `launchd` 配置文件 (`.plist`)**: 配置 `ProgramArguments` 来执行 `docker run` 命令，并设置 `KeepAlive` 为 `true`，同时配置好日志文件的输出路径。
* **第二阶段测试节点 (预计完成时间：2025年8月8日，周五)**
    * **测试方法**: 将 `.plist` 文件放置到 `~/Library/LaunchAgents/` 并加载。关键测试是手动 `docker kill` 正在运行的容器，观察并验证容器是否在几秒钟内被 `launchd` 自动重启。
    * **验收标准**: **服务能被 `launchd` 成功拉起，并且在被手动杀死后能自动恢复。**

---

#### **第三阶段：开发 Client 客户端应用 (预计时间：4天)**

* **目标**: 创建一个具备基本 UI 和核心连接逻辑的 macOS App。
* **任务**:
    1.  **实现音频采集与预处理**: 使用 `AVFoundation` 获取并处理麦克风音频，确保输出为 16kHz, 16-bit 的 PCM 数据。
    2.  **实现弹性 TCP 连接器**: 使用 `Network` 框架实现 TCP 连接，并内置带有指数退避策略的自动重连逻辑。
* **第三阶段测试节点 (预计完成时间：2025年8月14日，周四)**
    * **测试方法**: 启动 App 并连接服务，对着麦克风说话，确认能收到识别结果。再次手动 `docker kill` 容器，观察 App 是否能自动重连并恢复听写功能。
    * **验收标准**: **App 能成功连接服务并进行听写，且在服务短暂中断时能自动恢复连接。**

---

#### **第四阶段：功能集成与强化 (预计时间：3天)**

* **目标**: 完成所有核心功能并进行压力测试，确保应用的完整性和长期稳定性。
* **任务**:
    1.  **实现“隔空打字”功能**: 使用 `CGEvent` 模拟键盘输入，将识别结果打到当前任意活跃窗口。处理好辅助功能权限的请求。
* **第四阶段测试节点 (预计完成时间：2025年8月19日，周二)**
    * **测试方法**:
        1.  进行完整的端到端功能测试，验证“隔空打字”效果。
        2.  **压力测试**: 连续说话 15-30 分钟，观察系统资源占用情况。
        3.  **稳定性测试**: 将 App 和后台服务挂着运行一整天（12小时以上），期间不时进行听写，验证服务和 App 是否依然稳定。
    * **验收标准**: **核心功能完善，长时间运行稳定，资源占用在可接受范围内，可以满足日常使用。**